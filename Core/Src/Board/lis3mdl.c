/*******************************************************************************************************************************//**
 *
 * @file		lis3mdl.c
 * @proyect		EXAMPLE
 * @author		Velazquez LautaroÂ¿
 *
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/

#include "lis3mdl.h"

/***********************************************************************************************************************************
 *** PRIVATE DEFINES
 **********************************************************************************************************************************/

#define SLAVE_ADDRESS 	0x1C

#define CTRL_REG		0x20
#define READ_REG		0x28

#define CTRL3_DEFAULT	0x03
#define CTRL4_DEFAULT	0x00
#define CTRL5_DEFAULT	0x00

#define TEMP_ENABLE		(1U << 7U)
#define DATA_RATE_5HZ	(1U << 3U) | (1U << 2U)
#define SCALE_12_GAUSS	(1U << 6U)
#define MODE_DEFAULT	(1U << 1U) | (1U << 0U)

/***********************************************************************************************************************************
 *** PRIVATE MACROS
 **********************************************************************************************************************************/



/***********************************************************************************************************************************
 *** PRIVATE DATA
 **********************************************************************************************************************************/



/***********************************************************************************************************************************
 *** PUBLIC VARIABLES
 **********************************************************************************************************************************/



/***********************************************************************************************************************************
 *** PRIVATE VARIABLES
 **********************************************************************************************************************************/



/***********************************************************************************************************************************
 *** PRIVATE FUNCTION PROTOTYPE
 **********************************************************************************************************************************/



/***********************************************************************************************************************************
 *** PUBLIC FUNCTIONS
 **********************************************************************************************************************************/

void lis3mdl_init()
{
	uint8_t pData[5] = {TEMP_ENABLE | DATA_RATE_5HZ,
						SCALE_12_GAUSS,
						CTRL3_DEFAULT,
						CTRL4_DEFAULT,
						CTRL5_DEFAULT};

	HAL_I2C_Mem_Write_IT(&hi2c1, SLAVE_ADDRESS << 1U, CTRL_REG, I2C_MEMADD_SIZE_8BIT, pData, sizeof(pData));
}

lis3mdl_data lis3mdl_read()
{
	lis3mdl_data pData;
	HAL_I2C_Mem_Read(&hi2c1, SLAVE_ADDRESS << 1U, READ_REG, I2C_MEMADD_SIZE_8BIT, (uint8_t *)&pData, sizeof(lis3mdl_data), 1000);
	return pData;
}

/***********************************************************************************************************************************
 *** PRIVATE FUNCTION
 **********************************************************************************************************************************/



/*--------------------------------------------------------------------------------------------------------------------------------*/
